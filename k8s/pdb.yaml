---
# PodDisruptionBudget — ensures at least 1 backend pod stays up
# during node drains / rolling updates
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: savitara-backend-pdb
  namespace: savitara
  labels:
    app: savitara-backend
spec:
  # With 3 replicas: 2 must always be available → max 1 disrupted at a time
  minAvailable: 2
  selector:
    matchLabels:
      app: savitara-backend
---
# cert-manager ClusterIssuer (Let's Encrypt production)
# Apply once per cluster before creating Ingress resources.
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-prod
spec:
  acme:
    server: https://acme-v02.api.letsencrypt.org/directory
    # Replace with your email address
    email: devops@savitara.in
    privateKeySecretRef:
      name: letsencrypt-prod-key
    solvers:
      - http01:
          ingress:
            class: nginx
